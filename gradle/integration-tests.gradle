configurations {
    integrationTestCompile.extendsFrom testCompile
    integrationTestRuntime.extendsFrom integrationTestCompile, testRuntime
}

sourceSets {
    integrationTest {
        kotlin.srcDirs file("src/integration-test/kotlin")
        resources.srcDirs file("src/integration-test/resources")

        compileClasspath += sourceSets.main.output
        compileClasspath += configurations.compileOnly
        compileClasspath += configurations.testCompileOnly
        runtimeClasspath += compileClasspath
    }
}

task integrationTest(type: Test, description: "Runs the integration tests.", group: "Verification") {
    testClassesDirs = sourceSets.integrationTest.output.classesDirs
    classpath = sourceSets.integrationTest.runtimeClasspath

    jacoco {
        append = false
    }

    useJUnitPlatform() {
        includeEngines "spek"
    }

    jacocoTestReport {
        executionData file("$buildDir/jacoco/integration-test.exec")
    }
}

integrationTest.mustRunAfter test
check.dependsOn integrationTest
